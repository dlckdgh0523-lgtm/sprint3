<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hoya Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.quilljs.com/1.3.6/quill.snow.css"
      rel="stylesheet"
    />
    <script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>
    <style>
      .fade-in {
        animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
        transform: translateY(20px);
      }
      @keyframes fadeIn {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      body::-webkit-scrollbar {
        display: none;
      }
      .prose img {
        max-width: 100%;
        border-radius: 12px;
        margin: 20px auto;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }
      .ql-editor {
        min-height: 350px;
        font-size: 16px;
      }
      .ql-editor img {
        max-width: 80%;
        border-radius: 8px;
        margin: 15px auto;
        display: block;
      }
      .bg-grid-pattern {
        background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
        background-size: 20px 20px;
      }
    </style>
  </head>
  <body class="bg-slate-50 font-sans text-slate-800">
    <nav
      class="bg-white/80 backdrop-blur-md border-b border-slate-200 sticky top-0 z-50 h-16 shadow-sm"
    >
      <div
        class="container mx-auto px-6 h-full flex justify-between items-center"
      >
        <a
          href="#"
          onclick="location.reload()"
          class="flex items-center gap-2 group"
        >
          <div
            class="w-9 h-9 bg-slate-900 rounded-lg flex items-center justify-center text-white shadow-lg group-hover:rotate-12 transition-transform"
          >
            <i class="fa-solid fa-cube"></i>
          </div>
          <span class="text-xl font-bold tracking-tight text-slate-900"
            >Hoya</span
          >
        </a>
        <div class="hidden md:flex gap-8">
          <button
            onclick="loadPage('home')"
            class="font-bold text-slate-500 hover:text-slate-900 transition"
          >
            í™ˆ
          </button>
          <button
            onclick="loadPage('market')"
            class="font-bold text-slate-500 hover:text-pink-600 transition"
          >
            ê°œë°œ
          </button>
          <button
            onclick="loadPage('board')"
            class="font-bold text-slate-500 hover:text-blue-600 transition"
          >
            ê²Œì‹œíŒ
          </button>
        </div>
        <div class="flex items-center gap-3">
          <button
            onclick="openWriteModal()"
            class="bg-slate-900 hover:bg-slate-800 text-white px-4 py-2 rounded-full font-bold text-sm shadow-lg transition active:scale-95 flex items-center gap-2"
          >
            <i class="fa-solid fa-pen"></i> ê¸€ì“°ê¸°
          </button>
        </div>
      </div>
    </nav>

    <main
      id="content-area"
      class="container mx-auto px-4 py-8 min-h-[80vh]"
    ></main>

    <div
      id="detail-view"
      class="hidden fade-in container mx-auto px-4 py-8 max-w-4xl"
    >
      <button
        onclick="backToList()"
        class="mb-8 flex items-center gap-2 text-slate-400 hover:text-slate-800 font-bold transition group"
      >
        <div
          class="w-8 h-8 rounded-full bg-white border border-slate-200 flex items-center justify-center group-hover:border-slate-400 transition"
        >
          <i class="fa-solid fa-arrow-left"></i>
        </div>
        ëª©ë¡ìœ¼ë¡œ
      </button>
      <article
        class="bg-white rounded-[2rem] shadow-xl shadow-slate-200/50 border border-slate-100 overflow-hidden relative"
      >
        <div class="p-8 sm:p-12 pb-0">
          <div class="flex items-center gap-3 mb-6">
            <span
              id="detail-badge"
              class="px-3 py-1 rounded-full text-xs font-bold bg-slate-100 text-slate-600"
              >Category</span
            >
            <span class="text-slate-300 text-xs">â€¢</span>
            <span id="detail-date" class="text-slate-400 text-xs font-medium"
              >Date</span
            >
          </div>
          <h1
            id="detail-title"
            class="text-3xl sm:text-5xl font-black text-slate-900 mb-8 leading-tight break-keep"
          >
            Title
          </h1>
          <div
            class="flex items-center justify-between border-b border-slate-100 pb-8"
          >
            <div class="flex items-center gap-4">
              <img
                id="detail-avatar"
                src=""
                class="w-12 h-12 rounded-full border-2 border-white shadow-md bg-slate-100"
              />
              <div>
                <p class="font-bold text-slate-800 text-sm">ìµëª…ì˜ ê°œë°œì</p>
                <p class="text-xs text-slate-400 flex items-center gap-2">
                  <span id="detail-views">ì¡°íšŒ 0</span>
                  <span class="text-pink-500 font-bold"
                    >â™¥ <span id="header-like-count">0</span></span
                  >
                </p>
              </div>
            </div>
            <div id="detail-price-box" class="hidden text-right">
              <p
                class="text-3xl font-black text-pink-500 tracking-tight"
                id="detail-price"
              >
                0ì›
              </p>
            </div>
          </div>
        </div>
        <div class="px-8 sm:px-12 py-10">
          <div id="detail-content" class="min-h-[200px]"></div>
          <div id="detail-tags" class="flex gap-2 mt-12 flex-wrap"></div>
        </div>
        <div
          class="px-8 sm:px-12 py-6 bg-slate-50 border-t border-slate-100 flex justify-between items-center"
        >
          <button
            onclick="toggleLike()"
            id="btn-like"
            class="flex items-center gap-2 px-4 py-2 rounded-full bg-white border border-slate-200 text-slate-500 hover:text-pink-500 hover:border-pink-200 hover:bg-pink-50 transition shadow-sm group"
          >
            <i class="fa-regular fa-heart group-hover:hidden"></i
            ><i
              class="fa-solid fa-heart hidden group-hover:inline text-pink-500"
            ></i
            ><span class="font-bold"
              >ì¢‹ì•„ìš” <span id="btn-like-count">0</span></span
            >
          </button>
          <button
            id="btn-delete"
            class="text-slate-400 hover:text-red-500 text-sm font-medium transition underline decoration-transparent hover:decoration-red-500 underline-offset-4"
          >
            ì‚­ì œí•˜ê¸°
          </button>
        </div>
      </article>
      <div class="mt-12 max-w-3xl mx-auto">
        <h3
          class="text-xl font-bold mb-6 text-slate-800 flex items-center gap-2"
        >
          ëŒ“ê¸€
          <span
            class="text-sm font-normal text-slate-400"
            id="comment-count-label"
            >0</span
          >
        </h3>
        <form
          id="comment-form"
          class="bg-white p-2 rounded-2xl shadow-lg border border-slate-100 flex gap-2 items-center mb-10 sticky top-20 z-30"
        >
          <div class="relative group">
            <input
              type="file"
              id="comment-file"
              class="hidden"
              accept="image/*"
            />
            <label
              for="comment-file"
              class="w-10 h-10 rounded-xl hover:bg-slate-100 flex items-center justify-center text-slate-400 cursor-pointer transition"
              ><i
                class="fa-regular fa-image text-lg group-hover:text-pink-500"
              ></i
            ></label>
            <div
              id="comment-file-dot"
              class="hidden absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full border border-white"
            ></div>
          </div>
          <input
            type="text"
            id="comment-input"
            class="flex-1 bg-transparent px-2 py-3 outline-none text-sm placeholder-slate-400"
            placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."
            autocomplete="off"
          />
          <button
            type="submit"
            class="bg-slate-900 text-white w-10 h-10 rounded-xl flex items-center justify-center hover:bg-pink-600 transition shadow-md active:scale-90"
          >
            <i class="fa-solid fa-arrow-up"></i>
          </button>
        </form>
        <div id="comment-list" class="space-y-6 pb-20"></div>
      </div>
    </div>

    <div
      id="write-modal"
      class="fixed inset-0 bg-black/60 z-[100] hidden flex justify-center items-center backdrop-blur-sm transition-opacity p-4"
    >
      <div
        class="bg-white w-full max-w-4xl rounded-3xl shadow-2xl p-6 sm:p-8 transform scale-95 transition-transform duration-300 max-h-[95vh] overflow-y-auto"
      >
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-2xl font-bold text-slate-800">ê²Œì‹œë¬¼ ì‘ì„±</h3>
          <button
            onclick="closeWriteModal()"
            class="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600"
          >
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div class="flex bg-gray-100 p-1.5 rounded-xl mb-6">
          <button
            onclick="setWriteMode('market')"
            id="tab-write-market"
            class="flex-1 py-2.5 text-sm font-bold rounded-lg bg-white shadow-sm text-pink-600 transition-all"
          >
            ğŸ’» ê°œë°œ í”„ë¡œì íŠ¸
          </button>
          <button
            onclick="setWriteMode('board')"
            id="tab-write-board"
            class="flex-1 py-2.5 text-sm font-bold rounded-lg text-gray-500 hover:text-gray-700 transition-all"
          >
            ğŸ“ ììœ ê²Œì‹œíŒ
          </button>
        </div>
        <form id="unified-form" class="space-y-4">
          <input
            type="text"
            id="inp-title"
            class="w-full p-4 bg-gray-50 border rounded-2xl outline-none font-bold text-lg"
            placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”"
            required
          />
          <div id="market-fields" class="space-y-4">
            <div class="flex flex-col sm:flex-row gap-4">
              <input
                type="number"
                id="inp-price"
                class="w-full p-3 bg-gray-50 border rounded-xl outline-none font-medium"
                placeholder="ë¹„ìš© / ê°€ì¹˜ (ìˆ«ì)"
              />
              <input
                type="text"
                id="inp-tags"
                class="w-full p-3 bg-gray-50 border rounded-xl outline-none font-medium"
                placeholder="#íƒœê·¸ (ì½¤ë§ˆ êµ¬ë¶„)"
              />
            </div>
            <label
              class="block w-full p-3 border border-dashed border-gray-300 rounded-xl text-center text-gray-500 cursor-pointer hover:bg-gray-50 transition"
              ><i class="fa-solid fa-camera mr-2"></i> ëŒ€í‘œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
              <input
                type="file"
                id="inp-market-file"
                class="hidden"
                accept="image/*"
            /></label>
            <textarea
              id="inp-content-market"
              rows="5"
              class="w-full p-3 bg-gray-50 border rounded-xl outline-none resize-none"
              placeholder="ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
            ></textarea>
          </div>
          <div id="board-fields" class="hidden">
            <div id="editor-container" class="bg-white"></div>
            <p class="text-xs text-gray-400 mt-2">
              * íˆ´ë°”ì˜ ì‚¬ì§„ ì•„ì´ì½˜ì„ ëˆŒëŸ¬ ë³¸ë¬¸ì— ì‚¬ì§„ì„ ì¶”ê°€í•˜ì„¸ìš”.
            </p>
          </div>
          <button
            type="submit"
            class="w-full bg-slate-900 hover:bg-pink-600 text-white font-bold py-4 rounded-xl shadow-lg mt-4 transition"
          >
            ë“±ë¡ ì™„ë£Œ
          </button>
        </form>
      </div>
    </div>
    <input
      type="file"
      id="quill-image-input"
      class="hidden"
      accept="image/*"
      multiple
    />

    <script>
      // â˜… API ë³€ìˆ˜ ìˆ˜ì •ë¨: ë¹ˆ ê°’("")ìœ¼ë¡œ ë‘ë©´ í˜„ì¬ ë„ë©”ì¸ì„ ë”°ë¼ê°‘ë‹ˆë‹¤.
      // ë§Œì•½ íŠ¹ì • ì£¼ì†Œ(ì˜ˆ: http://localhost:8080)ê°€ í•„ìš”í•˜ë©´ ê·¸ ì£¼ì†Œë¥¼ ë„£ìœ¼ì„¸ìš”.
      const API = "";
      let currentMode = "market";
      let lastPage = "home";
      let currentDetailId = null;
      let currentDetailType = null;
      let quill;

      document.addEventListener("DOMContentLoaded", () => {
        loadPage("home");
        initQuill();
        document
          .getElementById("comment-file")
          .addEventListener("change", function () {
            const dot = document.getElementById("comment-file-dot");
            if (this.files.length > 0) dot.classList.remove("hidden");
            else dot.classList.add("hidden");
          });
      });

      async function loadPage(page) {
        lastPage = page;
        document.getElementById("detail-view").classList.add("hidden");
        const container = document.getElementById("list-view");
        if (container) container.classList.remove("hidden");

        const mainContent = document.getElementById("content-area");
        mainContent.innerHTML = "";

        // ==============================================
        // ğŸ  [í™ˆ í™”ë©´] ì›ë˜ í¬ê¸°ë¡œ ë³µêµ¬ + ìƒ‰ìƒ í¬ì¸íŠ¸ ì ìš©
        // ==============================================
        if (page === "home") {
          mainContent.innerHTML = `
                    <div class="relative bg-white rounded-[2rem] shadow-xl overflow-hidden border border-slate-100 fade-in">
                        <div class="absolute inset-0 bg-grid-pattern opacity-30"></div>
                        <div class="absolute -top-24 -right-24 w-64 h-64 bg-pink-100 rounded-full blur-3xl opacity-50"></div>
                        <div class="absolute -bottom-24 -left-24 w-64 h-64 bg-blue-100 rounded-full blur-3xl opacity-50"></div>

                        <div class="relative z-10 text-center py-20 px-6">
                            <span class="inline-block py-1 px-3 rounded-full bg-slate-100 text-slate-500 text-xs font-bold mb-6 tracking-wide">PORTFOLIO & COMMUNITY</span>
                            <h2 class="text-5xl sm:text-7xl font-black mb-6 text-slate-900 tracking-tight leading-tight">
                                Hoyaì˜ <br class="sm:hidden">
                                <span class="text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-indigo-500 animate-pulse">ê°œë°œ ë†€ì´í„°</span>
                            </h2>
                            <p class="text-lg sm:text-xl text-slate-500 mb-10 max-w-2xl mx-auto leading-relaxed">
                                ë‚´ê°€ ë§Œë“  í”„ë¡œì íŠ¸ë¥¼ ì „ì‹œí•˜ê³ , <br class="hidden sm:block">ì‚¬ëŒë“¤ê³¼ ììœ ë¡­ê²Œ ì†Œí†µí•˜ëŠ” ê³µê°„ì…ë‹ˆë‹¤.
                            </p>
                            
                            <div class="flex flex-col sm:flex-row justify-center gap-4">
                                <button onclick="loadPage('market')" class="group relative px-8 py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-xl hover:shadow-2xl hover:-translate-y-1 transition-all duration-300 overflow-hidden">
                                    <div class="absolute inset-0 bg-gradient-to-r from-pink-600 to-purple-600 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                                    <span class="relative flex items-center gap-2">
                                        <i class="fa-solid fa-code"></i> ê°œë°œ êµ¬ê²½í•˜ê¸°
                                    </span>
                                </button>

                                <button onclick="loadPage('game')" class="px-8 py-4 bg-white border border-slate-200 text-slate-700 rounded-2xl font-bold hover:border-purple-300 hover:text-purple-600 hover:bg-purple-50 transition shadow-sm hover:shadow-md flex items-center justify-center gap-2">
                                    <i class="fa-solid fa-gamepad text-purple-500"></i> ë¯¸ë‹ˆ ê²Œì„
                                </button>
                                
                                <button onclick="loadPage('board')" class="px-8 py-4 bg-white border border-slate-200 text-slate-700 rounded-2xl font-bold hover:border-blue-300 hover:text-blue-600 hover:bg-blue-50 transition shadow-sm hover:shadow-md flex items-center justify-center gap-2">
                                    <i class="fa-regular fa-comments text-blue-500"></i> ììœ ê²Œì‹œíŒ
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8 fade-in" style="animation-delay: 0.1s;">
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center">
                            <p class="text-3xl font-black text-slate-900">12+</p>
                            <p class="text-xs text-slate-400 font-bold mt-1">PROJECTS</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center">
                            <p class="text-3xl font-black text-slate-900">50+</p>
                            <p class="text-xs text-slate-400 font-bold mt-1">POSTS</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center">
                            <p class="text-3xl font-black text-slate-900">3</p>
                            <p class="text-xs text-slate-400 font-bold mt-1">GAMES</p>
                        </div>
                        <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm text-center">
                            <p class="text-3xl font-black text-slate-900">âˆ</p>
                            <p class="text-xs text-slate-400 font-bold mt-1">FUN</p>
                        </div>
                    </div>
                `;
        }

        // ==============================================
        // ğŸ›’ [ë§ˆì¼“ í˜ì´ì§€]
        // ==============================================
        else if (page === "market") {
          try {
            const res = await fetch(`${API}/products`);
            const rawData = await res.json();
            const list = Array.isArray(rawData) ? rawData : rawData.data || [];

            mainContent.innerHTML = `<h2 class="text-2xl font-bold mb-6 text-slate-800 fade-in"><i class="fa-solid fa-code text-pink-500 mr-2"></i>ê°œë°œ í¬íŠ¸í´ë¦¬ì˜¤</h2><div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 fade-in">${list
              .map(
                (p) => `
                        <div onclick="openDetail('products', ${p.id})" class="bg-white rounded-3xl shadow-sm border border-slate-100 p-4 relative group hover:-translate-y-1 transition cursor-pointer overflow-hidden">
                            <div class="relative overflow-hidden rounded-2xl mb-4 bg-gray-100 h-48">
                                <img src="${p.image ? p.image : `https://picsum.photos/seed/${p.id}/400/300`}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                            </div>
                            <h3 class="font-bold text-lg truncate text-slate-800">${p.last_name}</h3>
                            <p class="text-pink-500 font-bold mt-1">${p.price.toLocaleString()} P</p>
                        </div>`
              )
              .join("")}</div>`;
          } catch (e) {
            mainContent.innerHTML = `<div class="text-center py-10 text-gray-500">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨ (API ì£¼ì†Œ í™•ì¸ í•„ìš”)</div>`;
            console.error(e);
          }
        }

        // ==============================================
        // ğŸ® [ê²Œì„ í˜ì´ì§€]
        // ==============================================
        else if (page === "game") {
          mainContent.innerHTML = `<div class="fade-in"><h2 class="text-2xl font-bold mb-6 text-slate-800"><i class="fa-solid fa-gamepad text-purple-500 mr-2"></i>ë¯¸ë‹ˆ ê²Œì„</h2><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div onclick="playGame('snake')" class="bg-white p-8 rounded-3xl shadow-lg border hover:border-green-300 transition cursor-pointer text-center group hover:-translate-y-2"><div class="text-6xl mb-4 group-hover:scale-110 transition">ğŸ</div><h3 class="text-xl font-bold text-slate-800">ìŠ¤ë„¤ì´í¬</h3><p class="text-gray-400 mt-2 text-sm">Play Now!</p></div></div></div><div id="game-screen" class="hidden fixed inset-0 bg-black/90 z-[200] flex flex-col justify-center items-center p-4"><button onclick="closeGame()" class="absolute top-6 right-6 text-white text-xl font-bold border border-white px-4 py-2 rounded-full hover:bg-white hover:text-black transition">ë‹«ê¸° X</button><iframe id="game-frame" class="w-full max-w-lg h-[600px] bg-black border-4 border-gray-800 rounded-xl" frameborder="0"></iframe></div>`;
        }

        // ==============================================
        // ğŸ“ [ììœ ê²Œì‹œíŒ] (ê²Œì‹œê¸€ ë°•ìŠ¤ ì˜¤ë¥˜ ìˆ˜ì •ë¨)
        // ==============================================
        else if (page === "board") {
          try {
            const res = await fetch(`${API}/articles`);
            const rawData = await res.json();
            const list = Array.isArray(rawData) ? rawData : rawData.data || [];

            mainContent.innerHTML = `
                        <h2 class="text-2xl font-bold mb-6 text-slate-800 fade-in"><i class="fa-solid fa-comments text-blue-500 mr-2"></i>ììœ ê²Œì‹œíŒ</h2>
                        <div class="grid grid-cols-1 gap-4 max-w-4xl mx-auto fade-in">
                            ${list
                              .map((a) => {
                                const safeContent = a.content || "";
                                const tempDiv = document.createElement("div");
                                tempDiv.innerHTML = safeContent;
                                const imgTag = tempDiv.querySelector("img");
                                const thumbnailUrl =
                                  a.image || (imgTag ? imgTag.src : null);
                                const plainText =
                                  tempDiv.textContent ||
                                  tempDiv.innerText ||
                                  "";

                                return `
                                <div onclick="openDetail('articles', ${a.id})" class="bg-white p-6 rounded-3xl border border-slate-100 shadow-sm hover:shadow-lg hover:border-blue-200 transition cursor-pointer group flex flex-col sm:flex-row gap-6">
                                    ${
                                      thumbnailUrl
                                        ? `
                                        <div class="w-full sm:w-48 h-32 shrink-0 rounded-2xl overflow-hidden bg-gray-100">
                                            <img src="${thumbnailUrl}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500">
                                        </div>
                                    `
                                        : ""
                                    }
                                    <div class="flex-1 flex flex-col justify-center">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="bg-blue-50 text-blue-600 text-[10px] font-bold px-2 py-1 rounded-full">Community</span>
                                            <span class="text-slate-400 text-xs">${new Date(a.created_at).toLocaleDateString()}</span>
                                        </div>
                                        <h3 class="font-bold text-xl text-slate-800 mb-2 group-hover:text-blue-600 transition line-clamp-1">${a.title}</h3>
                                        <p class="text-slate-500 text-sm line-clamp-2 leading-relaxed mb-4">${plainText}</p>
                                        <div class="flex items-center gap-4 text-xs text-slate-400 font-medium">
                                            <span class="flex items-center gap-1"><i class="fa-regular fa-eye"></i> ${a.viewCount || 0}</span>
                                            <span class="flex items-center gap-1 group-hover:text-pink-500 transition"><i class="fa-solid fa-heart"></i> ${a.likeCount || 0}</span>
                                        </div>
                                    </div>
                                </div>
                                `;
                              })
                              .join("")}
                        </div>`;
          } catch (e) {
            mainContent.innerHTML = `<div class="text-center py-10 text-gray-500">ê²Œì‹œíŒ ë¡œë”© ì‹¤íŒ¨ (API í™•ì¸ í•„ìš”)</div>`;
            console.error(e);
          }
        }
      }

      async function openDetail(type, id) {
        currentDetailType = type;
        currentDetailId = id;
        document.getElementById("content-area").innerHTML = "";
        const detailView = document.getElementById("detail-view");
        detailView.classList.remove("hidden");
        document.getElementById("content-area").appendChild(detailView);
        window.scrollTo(0, 0);
        try {
          const res = await fetch(`${API}/${type}/${id}`);
          const data = await res.json();
          const isMarket = type === "products";
          document.getElementById("detail-badge").innerText = isMarket
            ? "ê°œë°œ"
            : "ê²Œì‹œíŒ";
          document.getElementById("detail-badge").className =
            `text-xs font-bold px-2 py-1 rounded mb-2 inline-block ${isMarket ? "bg-pink-100 text-pink-600" : "bg-blue-100 text-blue-600"}`;
          document.getElementById("detail-title").innerText = isMarket
            ? data.last_name
            : data.title;
          document.getElementById("detail-date").innerText = new Date(
            data.created_at
          ).toLocaleString();
          document.getElementById("detail-views").innerText =
            `ì¡°íšŒ ${data.viewCount}`;
          const likeCount = data.likeCount || 0;
          document.getElementById("header-like-count").innerText = likeCount;
          document.getElementById("btn-like-count").innerText = likeCount;
          const priceBox = document.getElementById("detail-price-box");
          const tagsDiv = document.getElementById("detail-tags");
          if (isMarket) {
            priceBox.classList.remove("hidden");
            document.getElementById("detail-price").innerText =
              `${data.price.toLocaleString()} point`;
            tagsDiv.innerHTML = data.tags
              .map(
                (t) =>
                  `<span class="bg-gray-100 px-2 py-1 rounded text-xs text-gray-500">#${t}</span>`
              )
              .join("");
          } else {
            priceBox.classList.add("hidden");
            tagsDiv.innerHTML = "";
          }
          const contentDiv = document.getElementById("detail-content");
          if (isMarket && data.image) {
            contentDiv.innerHTML = `<img src="${data.image}" class="w-full h-80 object-cover rounded-xl mb-6"> <p>${data.description}</p>`;
          } else {
            contentDiv.innerHTML = isMarket ? data.description : data.content;
          }
          document.getElementById("btn-delete").onclick = () =>
            deleteItem(type, id);
          fetchComments();
        } catch (e) {
          console.error(e);
          backToList();
        }
      }
      async function fetchComments() {
        const list = document.getElementById("comment-list");
        list.innerHTML =
          '<div class="text-center text-gray-400 py-4">ë¡œë”©ì¤‘...</div>';
        try {
          const res = await fetch(
            `${API}/comments/${currentDetailType}/${currentDetailId}`
          );
          const rawData = await res.json();
          const data = Array.isArray(rawData) ? rawData : rawData.data || [];
          document.getElementById("comment-count-label").innerText =
            data.length;
          if (data.length === 0) {
            list.innerHTML =
              '<div class="text-center text-gray-300 py-4">ì•„ì§ ëŒ“ê¸€ì´ ì—†ì–´ìš”. ì²« ë²ˆì§¸ ì£¼ì¸ê³µì´ ë˜ì–´ë³´ì„¸ìš”! ğŸˆ</div>';
            return;
          }
          list.innerHTML = data
            .map(
              (c) =>
                `<div class="flex gap-4 group"><div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-xl shrink-0">ğŸ˜Š</div><div class="flex-1"><div class="bg-white p-4 rounded-r-2xl rounded-bl-2xl shadow-sm border border-gray-100"><p class="text-slate-800 text-sm leading-relaxed">${c.content}</p>${c.image ? `<img src="${API}/${c.image}" class="mt-3 rounded-lg max-w-[200px] border border-slate-100 cursor-zoom-in" onclick="window.open(this.src)">` : ""}</div><span class="text-[10px] text-gray-400 mt-1 ml-2">${new Date(c.created_at).toLocaleString()}</span></div></div>`
            )
            .join("");
        } catch (e) {
          list.innerHTML = "ë¡œë”© ì‹¤íŒ¨";
        }
      }
      async function toggleLike() {
        const btn = document.getElementById("btn-like");
        const icon = btn.querySelector(".fa-heart");
        icon.classList.add("heart-beat");
        setTimeout(() => icon.classList.remove("heart-beat"), 300);
        try {
          const res = await fetch(
            `${API}/${currentDetailType}/${currentDetailId}/like`,
            { method: "PATCH" }
          );
          const data = await res.json();
          document.getElementById("header-like-count").innerText =
            data.likeCount;
          document.getElementById("btn-like-count").innerText = data.likeCount;
        } catch (e) {
          console.error(e);
        }
      }
      document
        .getElementById("comment-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const input = document.getElementById("comment-input");
          const fileInput = document.getElementById("comment-file");
          const formData = new FormData();
          formData.append("content", input.value);
          if (fileInput.files[0]) formData.append("image", fileInput.files[0]);
          try {
            const res = await fetch(
              `${API}/comments/${currentDetailType}/${currentDetailId}`,
              { method: "POST", body: formData }
            );
            if (res.ok) {
              input.value = "";
              fileInput.value = "";
              document
                .getElementById("comment-file-dot")
                .classList.add("hidden");
              fetchComments();
            } else alert("ì‹¤íŒ¨!");
          } catch (e) {
            console.error(e);
          }
        });
      function backToList() {
        document.getElementById("detail-view").classList.add("hidden");
        loadPage(lastPage);
      }
      async function deleteItem(type, id) {
        if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
        await fetch(`${API}/${type}/${id}`, { method: "DELETE" });
        backToList();
      }
      function playGame(gameName) {
        document.getElementById("game-screen").classList.remove("hidden");
        document.getElementById("game-frame").src = `/games/${gameName}.html`;
      }
      function closeGame() {
        document.getElementById("game-screen").classList.add("hidden");
        document.getElementById("game-frame").src = "";
      }
      function initQuill() {
        quill = new Quill("#editor-container", {
          theme: "snow",
          placeholder: "ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”...",
          modules: {
            toolbar: {
              container: [
                [{ header: [1, 2, false] }],
                ["bold", "italic", "underline"],
                ["image"],
              ],
              handlers: { image: imageHandler },
            },
          },
        });
      }
      function imageHandler() {
        const input = document.getElementById("quill-image-input");
        input.click();
        input.onchange = async () => {
          if (!input.files || input.files.length === 0) return;
          for (let i = 0; i < input.files.length; i++) {
            const file = input.files[i];
            const formData = new FormData();
            formData.append("image", file);
            try {
              const res = await fetch(`${API}/articles/upload`, {
                method: "POST",
                body: formData,
              });
              const data = await res.json();
              const range = quill.getSelection(true);
              quill.insertEmbed(range.index, "image", data.url);
              quill.setSelection(range.index + 1);
            } catch (e) {
              alert("ì—…ë¡œë“œ ì‹¤íŒ¨");
            }
          }
          input.value = "";
        };
      }
      document
        .getElementById("unified-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const title = document.getElementById("inp-title").value;
          if (currentMode === "market") {
            const formData = new FormData();
            formData.append("last_name", title);
            formData.append(
              "description",
              document.getElementById("inp-content-market").value
            );
            formData.append(
              "price",
              document.getElementById("inp-price").value
            );
            formData.append("tags", document.getElementById("inp-tags").value);
            if (document.getElementById("inp-market-file").files[0])
              formData.append(
                "image",
                document.getElementById("inp-market-file").files[0]
              );
            await sendData(`${API}/products`, "POST", formData, true);
          } else {
            const content = quill.root.innerHTML;
            await sendData(
              `${API}/articles`,
              "POST",
              JSON.stringify({ title, content }),
              false
            );
          }
        });
      async function sendData(url, method, body, isFile) {
        const options = { method, body };
        if (!isFile) options.headers = { "Content-Type": "application/json" };
        const res = await fetch(url, options);
        if (res.ok) {
          closeWriteModal();
          document.getElementById("unified-form").reset();
          quill.setContents([]);
          loadPage(currentMode);
          alert("ë“±ë¡ ì™„ë£Œ!");
        }
      }
      function openWriteModal() {
        document.getElementById("write-modal").classList.remove("hidden");
      }
      function closeWriteModal() {
        document.getElementById("write-modal").classList.add("hidden");
      }
      function setWriteMode(mode) {
        currentMode = mode;
        if (mode === "market") {
          document.getElementById("market-fields").classList.remove("hidden");
          document.getElementById("board-fields").classList.add("hidden");
          document
            .getElementById("tab-write-market")
            .classList.add("bg-white", "text-pink-600", "shadow-sm");
          document
            .getElementById("tab-write-board")
            .classList.remove("bg-white", "text-blue-600", "shadow-sm");
        } else {
          document.getElementById("market-fields").classList.add("hidden");
          document.getElementById("board-fields").classList.remove("hidden");
          document
            .getElementById("tab-write-board")
            .classList.add("bg-white", "text-blue-600", "shadow-sm");
          document
            .getElementById("tab-write-market")
            .classList.remove("bg-white", "text-pink-600", "shadow-sm");
        }
      }
      document.getElementById("write-modal").addEventListener("click", (e) => {
        if (e.target.id === "write-modal") closeWriteModal();
      });
    </script>
  </body>
</html>
